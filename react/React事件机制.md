### React事件机制

### 对事件机制的初步理解和验证

合成事件的触发是基于浏览器的事件机制来实现的，通过冒泡机制冒泡到最顶层元素，然后再由dispatchEvent统一去处理。

- 原生事件阻止冒泡肯定会阻止合成事件的触发。
- 合成事件的阻止冒泡不会影响原生事件。
- 两者最好不要混合使用，避免出现一些奇怪的问题

react 自己做这么多的意义是什么？

- 减少内存消耗，提升性能，不需要注册那么多的事件了，一种事件类型只在 document 上注册一次

- 统一规范，解决 ie 事件兼容问题，简化事件逻辑

- 对开发者友好

### 合成事件

- 对原生事件的封装。

- 对某些原生事件的升级和改造。

- 不同浏览器事件兼容的处理。

### 事件注册

1. react 拿到将要挂载的组件的虚拟 dom， 然后处理react dom 的 props ，判断属性内是否有声明为事件的属性，比如onClick,onChange,这个时候得到事件类型 click,change 和对应的事件处理程序 fn。

2. 完成事件注册。

3. 将react dom ，事件类型，处理函数 fn 放入数组存储。

4. 组件挂载完成后，处理 b 步骤生成的数组，经过遍历把事件处理函数存储到listenerBank(一个对象)中。

### 事件触发

1. 进入统一的事件分发函数(dispatchEvent)。

2.结合原生事件找到当前节点对应的ReactDOMComponent对象。

3.开始事件的合成

3.1 根据当前事件类型生成指定的合成对象。

3.2 封装原生事件和冒泡机制。

3.3 查找当前元素以及他所有父级。

3.4 在listenerBank查找事件回调并合成到 event(合成事件结束)。

4. 批量处理合成事件内的回调事件（事件触发完成 end）