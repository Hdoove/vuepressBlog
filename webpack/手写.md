### 手写

```javascript
/**
 * loader 其实就是一个方法
 */
const fs = require('fs');
const path = require('path');

module.export = function (source) {
    const callback = this.async();
    const images = source.match(/url\((\S*)\?_sprite/g);

    const matchImages = [];

    for(let i=0; i<images.length; i++) {
      const img = images[i].match(/url\((\S*)\?_sprite/)[1];
      matchImages.push(path.join(__dirname, img));
    }

    Spritesmith.run({
      src: matchImages
    }, (err, result) => {
      fs.writeFileSync(path.join(process.pwd(), 'dist/sprite.png'), result.image);
      source = source.replace(/url\((\S*)\?_sprite/g, (match) => {
        return `url(dist/sprite.png)`;
      });
      fs.writeFileSync(path.join(process.pwd(), 'dist/index.css'), source);
      callback(null, source);
    })
}

/**
 *plugin
 */

const pluginName = 'ConsoleLogOnBuildWebpackPlugin';

class ConsoleLogOnBuildWebpackPlugin {
  // 构造器参数，用于传递options
  constructor(options) {
    console.log("current plugin option is" + JSON.stringify(options))
  }
  // apply 方法是一个插件所必须的
  apply(compiler) {
    // compiler 继承自 tapable
    // tapable  提供了多种 hooks  https://github.com/webpack/tapable#hook-types
    // run      是 AsyncSeriesHook实例 [tapable提供的多种hooks的一种]
    compiler.hooks.run.tap(pluginName, compilation => {
      console.log('webpack 构建过程开始！');
    });
  }
}

module.exports = ConsoleLogOnBuildWebpackPlugin
```